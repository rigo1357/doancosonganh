<!doctype html>
<html lang="vi">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Đăng nhập - PPTLaptop</title><link rel="stylesheet" href="style.css"><link rel="stylesheet" href="auth.css"></head>
<body>
  <header class="header">
    <div class="container">
      <div class="brand"><div class="logo">PL</div></div>
      <nav><a href="index.html">Trang chủ</a><a href="products.html">Sản phẩm</a><a href="cart.html">Giỏ hàng</a></nav>
    </div>
  </header>

  <main class="container">
    <div class="auth-container">
      <div class="auth-tabs">
        <div class="auth-tab active" id="tab-login" onclick="showTab('login')">Đăng nhập</div>
        <div class="auth-tab" id="tab-register" onclick="showTab('register')">Đăng ký</div>
      </div>

      <div id="auth-msg"></div>

      <form id="login-form" class="auth-form">
        <label for="login-email">Email</label>
        <input id="login-email" type="email" placeholder="email@gmail.com" required />
        <label for="login-password">Mật khẩu</label>
        <input id="login-password" type="password" placeholder="Mật khẩu" required />
        <button type="submit" class="btn">Đăng nhập</button>
      </form>

      <form id="register-form" class="auth-form" style="display:none">
        <label for="reg-email">Email</label>
        <input id="reg-email" type="email" placeholder="email@gmail.com" required />
        <label for="reg-password">Mật khẩu</label>
        <input id="reg-password" type="password" placeholder="Mật khẩu (>=6 ký tự)" required />
        <button type="submit" class="btn secondary">Đăng ký</button>
      </form>

      <form id="otp-form" class="auth-form" style="display:none">
        <label for="otp-input">Nhập mã OTP (demo)</label>
        <input id="otp-input" placeholder="Mã 6 chữ số" required />
        <button type="submit" class="btn">Xác thực</button>
      </form>
    </div>
  </main>

  <script>
    // simple user store
    let users = JSON.parse(localStorage.getItem('users') || '[]');
    // ensure at least one user demo
    if(!users.find(u=>u.email==='admin@gmail.com')){ users.push({email:'admin@gmail.com', password:'123456'}); localStorage.setItem('users', JSON.stringify(users)); }

    function showTab(t){
      document.getElementById('tab-login').classList.toggle('active', t==='login');
      document.getElementById('tab-register').classList.toggle('active', t==='register');
      document.getElementById('login-form').style.display = t==='login' ? 'block' : 'none';
      document.getElementById('register-form').style.display = t==='register' ? 'block' : 'none';
      document.getElementById('otp-form').style.display = 'none';
      document.getElementById('auth-msg').innerHTML = '';
    }

    let pendingUser = null; let otpCode = null;

    document.getElementById('register-form').onsubmit = function(e){
      e.preventDefault();
      const email = document.getElementById('reg-email').value.trim();
      const password = document.getElementById('reg-password').value;
      if(!email || !password) return showMsg('Nhập đầy đủ thông tin');
      if(password.length < 6) return showMsg('Mật khẩu phải >= 6 ký tự');
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      if(users.find(u=>u.email === email)) return showMsg('Email đã đăng ký');
      otpCode = Math.floor(100000 + Math.random()*900000).toString();
      pendingUser = {email, password};
      showMsg('Mã OTP (demo): <b>'+otpCode+'</b>. Nhập vào ô OTP để xác thực.', true);
      document.getElementById('register-form').style.display='none';
      document.getElementById('otp-form').style.display='block';
    };

    document.getElementById('otp-form').onsubmit = function(e){
      e.preventDefault();
      const v = document.getElementById('otp-input').value.trim();
      if(v !== otpCode) return showMsg('OTP không đúng');
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      users.push(pendingUser);
      localStorage.setItem('users', JSON.stringify(users));
      showMsg('Đăng ký thành công!', true);
      setTimeout(()=>{ showTab('login'); document.getElementById('otp-form').reset(); }, 1000);
      pendingUser = null; otpCode = null;
    };

    document.getElementById('login-form').onsubmit = function(e){
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u=>u.email===email && u.password===password);
      if(!user) return showMsg('Email hoặc mật khẩu không đúng');
      localStorage.setItem('currentUser', JSON.stringify(user));
      showMsg('Đăng nhập thành công!', true);
      setTimeout(()=> location.href = 'index.html', 800);
    };

    function showMsg(msg, success=false){
      document.getElementById('auth-msg').innerHTML = `<div class="${success ? 'auth-success' : 'auth-msg'}">${msg}</div>`;
    }
  </script>
</body>
</html>
